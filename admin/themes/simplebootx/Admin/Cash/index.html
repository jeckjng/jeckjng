<admintpl file="header" />
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<!--<li class="active"><a >提现记录</a></li>-->
			{:getTableMenu($_GET['menuid'],'Admin/Cash/index')}
		</ul>
		<form class="well form-search" name="form1" method="post" action="{:U('index')}">
			<div style="">
				<div class="search-box">
					<input type="text" name="start_time" class="js-date date" id="start_time" value="{$param.start_time}" style="width: 80px;" autocomplete="off" placeholder="时间">
				</div>
				<div class="search-box">
					<input type="button" data-time_type="today" class="btn btn-primary cust-time-select {:$param['time_type']=='today' ? '' : 'bg-color-white color-black'}" value="今日" data-time_start="{:explode(' ',$time_se['today_start'])[0]}" data-time_end="{:explode(' ',$time_se['today_end'])[0]}" />
				</div>
				<div class="search-box">
					<input type="button" data-time_type="tweek" class="btn btn-primary cust-time-select {:$param['time_type']=='tweek' ? '' : 'bg-color-white color-black'}" value="本周" data-time_start="{:explode(' ',$time_se['tweek_start'])[0]}" data-time_end="{:explode(' ',$time_se['tweek_end'])[0]}" />
				</div>
				<div class="search-box">
					<input type="button" data-time_type="tmonth" class="btn btn-primary cust-time-select {:$param['time_type']=='tmonth' ? '' : 'bg-color-white color-black'}" value="本月" data-time_start="{:explode(' ',$time_se['tmonth_start'])[0]}" data-time_end="{:explode(' ',$time_se['tmonth_end'])[0]}" />
				</div>
				<if condition="$role_id == 1">
					<div class="search-box">
						<select class="select_2 width-200" name="tenant_id" id="tenant_id">
							<volist name="tenant_list" id="vo">
								<option value="{$vo['id']}" <if condition="$param['tenant_id'] eq $vo['id']">selected</if> >{$vo['name']}</option>
							</volist>
						</select>
					</div>
				</if>
				<div class="search-box">
					<select class="select_2 width-120" name="status">
						<option value="-1" <if condition="$param['status'] eq '-1'">selected</if>>全部（订单状态）</option>
						<volist name="status_list" id="vo">
							<option value="{$key}" <if condition="$param['status'] eq $key">selected</if> >{$vo['name']}</option>
						</volist>
					</select>
				</div>
				<div class="search-box">
					<select class="select_2 width-120" name="currency_code">
						<option value="" <if condition="$param['currency_code'] eq ''">selected</if>>全部（币种）</option>
						<volist name="currency_list" id="vo">
							<option value="{$vo.code}" <if condition="$param['currency_code'] eq $vo['code']">selected</if> >{$vo['name']}</option>
						</volist>
					</select>
				</div>
				<div class="search-box">
					<input type="text" name="uid" class="width-140" style="" value="{$param.uid}" placeholder="用户ID">
				</div>
				<div class="search-box">
					<input type="text" name="user_login" class="width-160" value="{$param.user_login}" placeholder="用户账号">
				</div>
			</div>
			<div style="">
				<div class="search-box">
					<input type="text" class="js-date date" name="end_time" id="end_time" value="{$param.end_time}" style="width: 80px;" autocomplete="off" placeholder="时间">
				</div>
				<div class="search-box">
					<input type="button" data-time_type="ytoday" class="btn btn-primary cust-time-select {:$param['time_type']=='ytoday' ? '' : 'bg-color-white color-black'}" value="昨日" data-time_start="{:explode(' ',$time_se['ytoday_start'])[0]}" data-time_end="{:explode(' ',$time_se['ytoday_end'])[0]}" />
				</div>
				<div class="search-box">
					<input type="button" data-time_type="yweek" class="btn btn-primary cust-time-select {:$param['time_type']=='yweek' ? '' : 'bg-color-white color-black'}" value="上周" data-time_start="{:explode(' ',$time_se['yweek_start'])[0]}" data-time_end="{:explode(' ',$time_se['yweek_end'])[0]}" />
				</div>
				<div class="search-box">
					<input type="button" data-time_type="ymonth" class="btn btn-primary cust-time-select {:$param['time_type']=='ymonth' ? '' : 'bg-color-white color-black'}" value="上月" data-time_start="{:explode(' ',$time_se['ymonth_start'])[0]}" data-time_end="{:explode(' ',$time_se['ymonth_end'])[0]}" />
				</div>
				<div class="search-box">
					<select class="select_2 width-120" name="search_time_type">
						<option value="1" <if condition="$param['search_time_type'] eq 1">selected</if> >下单时间</option>
						<option value="2" <if condition="$param['search_time_type'] eq 2">selected</if> >处理时间</option>
					</select>
				</div>
				<div class="search-box">
					<select class="select_2 width-120" name="user_type">
						<option value="-1" <if condition="$param['user_type'] eq '-1'">selected</if>>全部（用户类型）</option>
						<volist name="user_type_list" id="vo">
							<option value="{$vo.type}" <if condition="$param['user_type'] eq $vo['type']">selected</if> >{$vo['name']}</option>
						</volist>
					</select>
				</div>
				<div class="search-box">
					<input type="text" name="orderno" style="" value="{$param.orderno}" placeholder="系统订单号">
				</div>
				<div class="search-box">
					<input type="text" name="trade_no" style="" value="{$param.trade_no}" placeholder="三方订单号">
				</div>
				<div class="search-box">
					<input type="text" name="superior_user_login" class="width-160" value="{$param.superior_user_login}" placeholder="上级账号">
				</div>
			</div>
			<div>
				<div class="search-box">
					<input type="hidden" name="time_type" id="time_type" value="{$param['time_type']}"/>
				</div>
				<div class="search-box">
					<input type="submit" class="btn btn-primary" value="搜索" onclick="form1.action='{:U(\'index\')}';form1.submit();"/>
				</div>
				<div class="search-box">
					<input type="button" class="btn btn-primary {:showHidden(U('export'))}" style="background-color: #1dccaa;" value="导出" onclick="form1.action='{:U(\'export\')}';form1.submit();"/>
				</div>
			</div>
			<div class="admin_main" style="margin-top: 15px;">
				总人民币金额：<a>{$rnb_money}</a>元<br>
				各币种金额：
				<volist name="total_money_list" id="vo">
					{$key}<a>：{$vo}</a>
				</volist>
			</div>
		</form>	
		
		<form name="formcontent" method="post" class="cust-js-ajax-form" style="white-space: nowrap;overflow-x: auto;">
			<div class="table-actions">
				<input type="hidden" name="tenant_id" value="{$param['tenant_id']}">
				<button type="button" class="btn btn-success btn-small cust-filter-column" data-table_id="list_content" data-page_name="{:U('index')}">列展示</button>
				<button type="submit" class="btn btn-success btn-small" onclick="batch_check(this, formcontent, '{:U(\'batch_check\', array(\'status\'=>1))}')" data-option="{confirm:true,msg:'批量审核通过',waittime:1000}">批量审核通过</button>
				<button type="submit" class="btn btn-warning btn-small" onclick="batch_check(this, formcontent, '{:U(\'batch_check\', array(\'status\'=>2))}')" data-option="{confirm:true,msg:'批量拒绝',waittime:1000}">批量拒绝</button>
			</div>
			<table class="table table-hover table-bordered" id="list_content">
				<thead>
					<tr>
						<th data-field="checkbox" ><input style="margin: 0 0 0 5px" type="checkbox" class="js-check-all" data-direction="x" data-checklist="js-check-x">全选</th>
						<th data-field="ID" class="align-center-i">ID</th>
						<th data-field="order" class="align-center-i">订单号</th>
						<th data-field="user" class="align-center-i">用户信息</th>
						<th data-field="withdrawal_action_currency" class="align-center-i">提现金额</th>
						<th data-field="received_money" class="align-center-i">到账金额</th>
						<th data-field="service_fee" class="align-center-i">手续费</th>
						<th data-field="withdrawal_rnb" class="align-center-i">提现金额(人民币)</th>
						<th data-field="pay_coin" class="align-center-i">提现种类</th>
						<th data-field="cash_account" class="align-center-i">提现账号</th>
						<th data-field="qr_code_url" class="align-center-i">二维码</th>
						<th data-field="rate" class="align-center-i">汇率</th>
						<th data-field="status_name" class="align-center-i">状态</th>
						<th data-field="des" class="align-center-i">备注</th>
						<th data-field="time" class="align-center-i">下单时间<br>处理时间</th>
						<php>if($_SESSION["role_id"] == '1'){</php>
						<th data-field="tenant_name" class="align-center-i">租户</th>
						<php>}</php>
						<th data-field="operated_by" class="align-center-i">操作人</th>
						<th data-field="action" class="align-center-i">{:L('ACTIONS')}</th>
					</tr>
				</thead>
				<tbody>
					<foreach name="list" item="vo">
					<tr>
						<td data-field="checkbox">
							<if condition="$vo['status'] eq '0'" >
								<input type="checkbox" class="js-check" data-yid="js-check-y" data-xid="js-check-x" name="ids[]" value="{$vo.id}">
							</if>
						</td>
						<td data-field="ID" class="align-center-i">{$vo.id}</td>
						<td data-field="order">
							系统: {$vo.orderno}<br>
							三方: {$vo.trade_no}
						</td>
						<td data-field="user" >
							上级账号: {$vo['superior_user_login']}<br><br>
							用户后ID: {$vo.uid}<br>
							用后账号: {$vo['user_login']}<br>
						</td>
						<td data-field="withdrawal_action_currency" class="align-center-i">{$vo['money']}（{$vo['currency']}）</td>
						<td data-field="received_money" class="align-center-i">{$vo['received_money']}（{$vo['currency']}）</td>
						<td data-field="service_fee" class="align-center-i">{$vo['service_fee']}（{$vo['currency']}）</td>
						<td data-field="withdrawal_rnb" class="align-center-i">{$vo['rnb_money']}</td>
						<td data-field="pay_coin" class="align-center-i">
							<if condition="$vo['pay_coin'] eq '1'" >
								充值余额
							<else />
								主播映票(主播提成)
							</if>
						</td>
						<td data-field="cash_account" class="align-center-i">
							<if condition="$vo['cash_account_type'] eq 1">
                            	<br>{$vo['name']}<br>{$vo['account']}<br>{$vo['account_bank']}
							<else/>
								<br>{$vo['cash_network_type']}<br>{$vo['virtual_coin_address']}
							</if>
                        </td>
						<td data-field="qr_code_url" class="align-center-i"><img src="{$vo['qr_code_url']}" alt="" class="img-zoom" style="min-width: 50px; max-height: 100px; max-width: 100px;"></td>
						<td data-field="rate" class="align-center-i">1:{$vo['rate']}</td>
						<td data-field="status_name" class="align-center-i">{$vo['status_name']}</td>
						<td data-field="des" class="align-center-i">{$vo['des']}</td>
						<td data-field="time" class="align-center-i">
							{$vo.addtime|date="Y-m-d H:i:s",###}<br>
							<if condition="$vo['status'] eq '0'">未处理<else/>{$vo.uptime|date="Y-m-d H:i:s",###}</if>
						</td>
						<php>if($_SESSION["role_id"] == '1'){</php>
						<td data-field="tenant_name" class="align-center-i">{$vo['tenant_name']}</td>
						<php>}</php>
						<td data-field="operated_by" class="align-center-i">{$vo['operated_by']}</td>
						<td data-field="action" class="align-center-i">
							<if condition="$vo['status'] eq '0'" >
								<a href="{:U('Cash/edit',array('id'=>$vo['id']))}" >编辑</a>
							</if>
						</td>
					</tr>
					</foreach>
				</tbody>
			</table>
			<div class="pagination">{$page}</div>
		</form>
	</div>
</body>
</html>
<script src="__PUBLIC__/js/md5/jquery.md5.js"></script>
<script src="__PUBLIC__/js/common.js?v={:jsversion()}"></script>
<script src="__PUBLIC__/js/imgzoom/imgzoom.js"></script>
<script type="text/javascript">
	// 筛选列，是否有隐藏的，如果有则隐藏不显示
	$(document).ready(function (){
		var cust_filter_column_obj = $('.cust-filter-column');
		var cust_filter_column_key = "cust-filter-column-" + $.md5($(cust_filter_column_obj).attr('data-page_name'));
		var checked_no_json = window.localStorage.getItem(cust_filter_column_key)
		if(checked_no_json){
			checked_no_list = JSON.parse(checked_no_json);
			var table_id = $(cust_filter_column_obj).attr('data-table_id');
			$.each(checked_no_list, function (index, val){
				data_field = val
				$('#'+table_id).children('thead').find("[data-field='" + data_field + "']").addClass('filter-checked-no').removeClass('filter-checked-yes').css('display', 'none');
				$('#'+table_id).children('tbody').find("[data-field='" + data_field + "']").addClass('filter-checked-no').removeClass('filter-checked-yes').css('display', 'none');
			})
		}

		new ImgZoom();
	});

	function batch_check(btnobj, formcontentobj, uri){
		$(formcontentobj).attr('action', uri).find("button[type='submit']").removeClass('cust-js-ajax-submit');
		$(btnobj).addClass('cust-js-ajax-submit');
	}
</script>
